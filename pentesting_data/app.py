import nmap
import json
from flask import Flask, jsonify
import socket

app = Flask(__name__)

@app.route('/')
def scan():
    return jsonify({"resultado":scan_network('192.168.100.0/24') })
    

def scan_network(network):
    nm = nmap.PortScanner()
    return nm.scan(hosts=network)  # Perform a ping scan to find hosts
    #  nm.all_hosts()



    # for host in nm.all_hosts():
    #     host_info = {
    #         'hostname': nm[host].hostname(),
    #         'ip_address': host,
    #         'mac_address': nm[host]['addresses'].get('mac', 'N/A'),
    #         'open_ports': []
    #     }
        
    #     # Perform a service scan on the host to find open ports
    #     nm.scan(host, arguments='--open -p 1-65535')
        
    #     for proto in nm[host].all_protocols():
    #         ports = nm[host][proto].keys()
    #         for port in ports:
    #             host_info['open_ports'].append({
    #                 'port': port,
    #                 'state': nm[host][proto][port]['state']
    #             })

    #     results.append(host_info)

    # return results

if __name__ == '__main__':
    app.run(host='0.0.0.0' , port=5001)

# if __name__ == "__main__":
#     network_to_scan = '192.168.1.0/24'  # Change this to your network
#     scan_results = scan_network(network_to_scan)
#     print(json.dumps(scan_results, indent=4))
